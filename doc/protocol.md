# Protocol

## Model

```
type Packet struct {
	ComputerId   string         `json:"computerid"`
	PacketId     string         `json:"packetid"`
	PacketType   string         `json:"packetType"`
	Arguments    PacketArgument `json:"arguments"`
	Response     PacketResponse `json:"response"`
	DownstreamId string         `json:"downstreamId"`
}
```

* `ComputerId`: A unique ID, generated at each start of client.exe
* `PacketId`: A random packet ID, generated by the packet-creater (mostly server, sometimes client)
* `PacketType`: What command to execute, how `Arguments` and `Response` should be interpreted
* `Arguments`: Arguments for the command
* `Response`: Response to the command
* `DownstreamId`: On which downstream the command should be executed (default is "client")



## Packet Argument/Response definition

General:
* Response: 
  * "error": Any Go err.Error() information when handling the packet

### "ping" 

* Arguments: None 
* Response: 
  * "response" = "ping answer"

### "test"

* Arguments: None 
* Response: 
  * "response" = "response"

### "execShell"
 
* Arguments: 
  * "shelltype": "cmd" or "powershell"
  * "commandline": What should be executed (e.g. "dir")

* Response:
  * "stdout"
  * "stderr"
  * "pid"
  * "exitCode"

### "execLol"

* Arguments: 
  * "executable": path to the executable to execute
  * "argline": all parameters as string, e.g. "-v user test"
  * "spawnType": "copyFirst" or "hollow"
  * "spawnData":
    * for "copyFirst": path to where to copy the file first
    * for "hollow": path to an existing executable to hollow

* Response:
  * "stdout"
  * "stderr"
  * "pid"
  * "exitCode"


### "execRemote"

* Arguments: 
  * "filename": filename of a file on the server `static/` directory
  * "argline": all parameters as string, e.g. "-v user test"
  * "injectInto": path to an existing executable to inject into
  * "isDotnet": if the file is managed code / dotNet (used for Donut shellcode generation)

* Response:
  * "stdout"
  * "stderr"
  * "pid"
  * "exitCode"

This will initiate a "secureFileDownload".

### "filedownload"

* Arguments: 
  * "remoteurl": URL to download (usuall C2 server)
  * "destination": Path/filename of where to download

* Response: 
  * "response": a string showing success, or not

### "fileupload"

* Arguments:
  * "remoteurl": Where to upload (usually C2 server)
  * "source": Which file/path to upload

* Response: 
  * "response": HTTP status of upload

### "iOpen" 

* Arguments: 
  * "force": Optional, reopens shell even if active

* Response: 
  * "stdout": Initial output of shell
  * "stderr": Initial error output of shell

### "iIssue" 

* Arguments: 
  * "commandline": Stuff to write to the shell (usually a command line)

* Response: 
  * "stdout": Standard output of the shell
  * "stderr": Standard error of the shell

### "iClose"

* Arguments: None
* Response:
  * "stdout": "closed"

### "dir"

* Arguments: 
  * "path": Path to list
* Response:
  * "filelist": JSON of DirEntry array of files/directories